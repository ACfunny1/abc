<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="css.css">
	<link rel="stylesheet" href="iconfont.css">
</head>
<body>
	<div class="pageOne">
		<main>
			<div class="coverPic"></div>
			<a href="#" class="btn_heart">&#xeca1</a>
			<a href="#" class="btn_start">&#xe633</a>
			<a href="#" class="btn_next">&#xe602</a>
			<span class="label">90后</span>	
			<p class="title">Sunshine Girl</p>

			<span class="bofang_icon">&#xe606</span>
			<span class="bofang_counts">123</span>
			<span class="shoucang_icon">&#xeca1</span>
			<span class="shoucang_counts">123</span>
			<span class="dianzan_icon">&#xe60c</span>
			<span class="dianzan_counts">123</span>

			<div class="music_bar"></div>
			<div class="music_bar2"></div>
			<div class="music_time">0:00</div>

			<span class="singer">陈奕迅</span>
			<span class="lyric">okokokokokokokok</span>
		</main>
		<div class="bg"></div>
		<footer>
			<a href="#" class="btn_left">&#xe64e</a>
			<a href='#' class="btn_right">&#xe62e</a>
			<ul class="box"></ul>
		</footer>
	</div>
	<div class="pageTwo"></div>

	<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
	<script>

		start()
		setPicClick()
		setLR_Click()
		getSong()
		setNextSong()

		function start(){
			getFmPic(function(data){
				//console.log(data.channels)
				$.each(data.channels,function(idx,e){
					var $node = $liNode(e)
					$node.appendTo('.box')
				})
				clearF().appendTo('.box')
				setBoxWidth()
			})
		}

		function getFmPic (callback){
			$.ajax({
				url:'http://api.jirengu.com/fm/getChannels.php',
				type:'get',
				dataType:'jsonp'
			}).done(function(ret){
				callback(ret)
			})
		}

		function $liNode(e){
			var tpl = ''
			tpl += '<li>'
			tpl += '<a href="#">'
			/*tpl += '<div class="box_bg" style="background-image:url('+e.cover_small+')"></div>'*/
			tpl += '<div class="box_bg" style="background-image:url('+e.cover_small+')" mid="url('+e.cover_middle+')" big="url('+e.cover_big+')"></div>'
			tpl += '</a>'
			tpl += '<p>'+e.name+'</p>'
			tpl += '</li>'
			return $(tpl)
		}

		function clearF(){
			var tpl = ''
			tpl += '<div class = "clear"></div>'

			return $(tpl)
		}

		function setBoxWidth(){
			var node = $('.box')
			var sum = (parseInt(node.children().length)-1)*15
			node.css(
				"width",sum+'vh'
			)
		}

		function setPicClick(){
			$('.box').on('click','.box_bg',function(e){
				$(e.target).parents('li').siblings().find('.box_bg').removeClass('active')
				$(e.target).addClass('active')
				var midStyle = $(e.target).attr('mid')
				var bigStyle = $(e.target).attr('big')
				//console.log(midStyle)
				$('.coverPic').css('background-image',midStyle)
				$('.bg').css('background-image',bigStyle)
			})
		}

		function setLR_Click(){
			var leftSum = 0
			var $box = $('.box')
			$('.btn_left').on('click',function(){
				if(parseInt($box.position().left)<0){
					$box.animate({'left':(leftSum+=100)+'vh'},600)
				}
			})

			$('.btn_right').on('click',function(){
				if(-parseInt($box.position().left)/$box.width() <0.8){
					$box.animate({'left':(leftSum-=100)+'vh'},600)
				}
			})
		}

		function getSong(){
			$.ajax({
				url:'http://api.jirengu.com/fm/getSong.php',
				type:'get',
				dataType:'jsonp'
			}).done(function(ret){
				$.each(ret.song,function(idx,e){
					console.log(e)
				})
			})
		}

		function setNextSong(){
			$('.btn_next').on('click',function(){
				console.log('ok')
			})
		}

		function getLyric(){
			$.ajax({
				url:'http://api.jirengu.com/fm/getLyric.php',
				type:'get',
				dataType:'jsonp',
				data: {
					sid:290850128
				}
			}).done(function(ret){
				console.log(ret)
			})
		}
	</script>
</body>
</html>
